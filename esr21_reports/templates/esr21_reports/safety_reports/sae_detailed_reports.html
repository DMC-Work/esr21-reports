{% extends 'edc_base/base.html' %}
{% load static %}


{% block extra-styles %}
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" >
<link href="https://cdn.datatables.net/buttons/2.0.1/css/buttons.bootstrap.min.css" rel='stylesheet'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
<style>
    html{
    
	overflow-y: scroll;
}
.row{
 margin-top:10px;
 padding: 0 10px;
}

.clickable{
 cursor: pointer;   
}

.panel-heading span {
 margin-top: -20px;
 font-size: 15px;
}

.horizontal-scrollable > .row {
 overflow-x: auto;
 white-space: nowrap;
}

.horizontal-scrollable > .row > .col-xs-4 {
 display: inline-block;
 float: none;
}
/* Decorations */

.col-xs-4 {
 color: white;
 font-size: 24px;
 padding-bottom: 20px;
 padding-top: 18px;
}

.col-xs-4:nth-child(2n+1) {
 background: green;
}

.col-xs-4:nth-child(2n+2) {
 background: black;
}
</style>
{% endblock extra-styles %}


{% block extra-scripts %}
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/dataTables.bootstrap.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.0.1/js/buttons.colVis.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.2/dist/chart.min.js"></script>
<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>


<script type="text/javascript" src="http://code.jquery.com/jquery-1.10.0.min.js"></script>
<script type="text/javascript" src="{% static 'js/Chart.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/vendor.bundle.base.js' %}"></script>

 <script type="application/javascript">
    $(document).ready(function() {
        $('#example').DataTable({
        "pageLength": 5,
        scrollX:        300,
	    deferRender:    true,
	    scroller:       true,
	    
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    } );

    table.buttons().container()
        .appendTo( '#example .col-sm-6:eq(0)' );
    } );

     $(document).ready(function() {
        $('#example1').DataTable({
        "pageLength": 5,
         scrollX:        300,
	     deferRender:    true,
	     scroller:       true,
         dom: 'Bfrtip',
         buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
         ]
    } );

    table.buttons().container()
        .appendTo( '#example1 .col-sm-6:eq(0)' );
    } );

    $(document).ready(function() {
        $('#example3').DataTable({
        "pageLength": 5,
         scrollX:        300,
	     deferRender:    true,
	     scroller:       true,
         dom: 'Bfrtip',
         buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
         ]
    } );

    table.buttons().container()
        .appendTo( '#example3 .col-sm-6:eq(0)' );
    } );
    
    $(document).ready(function() {
        $('#example5').DataTable({
        "pageLength": 5,
         scrollX:        300,
	    deferRender:    true,
	    scroller:       true,
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    } );

    table.buttons().container()
        .appendTo( '#example5 .col-sm-6:eq(0)' );
    } );
    
    
    $(document).ready(function() {
        $('#example4').DataTable({
        "pageLength": 5,
         scrollX:        300,
	    deferRender:    true,
	    scroller:       true,
        dom: 'Bfrtip',
        buttons: [
            'copy', 'csv', 'excel', 'pdf', 'print'
        ]
    } );

    table.buttons().container()
        .appendTo( '#example4 .col-sm-6:eq(0)' );
    } );
    

    $(document).ready(function() {
        var barChartCanvas = $("#barChart1").get(0).getContext("2d");
			var labels = {{ sites| safe }}
			var data = {{ experienced_sae_events_data| safe }}
			var barChart = new Chart(barChartCanvas, {
				type: 'bar',
				data: {
					labels:labels ,
					datasets: [{
						label: '# Experienced SAE',
						data: data,
						backgroundColor: [
						'rgba(255, 99, 132, 0.2)',
						'rgba(54, 162, 235, 0.2)',
						'rgba(255, 206, 86, 0.2)',
						'rgba(75, 192, 192, 0.2)',
						'rgba(153, 102, 255, 0.2)',
						'rgba(255, 159, 64, 0.2)'
						],
						borderColor: [
						'rgba(255,99,132,1)',
						'rgba(54, 162, 235, 1)',
						'rgba(255, 206, 86, 1)',
						'rgba(75, 192, 192, 1)',
						'rgba(153, 102, 255, 1)',
						'rgba(255, 159, 64, 1)'
						],
						borderWidth: 1,
						fill: false
					}]
					},
			});
    });

   $(document).ready(function() {
		var barChartCanvas = $("#barChart2").get(0).getContext("2d");
			var labels = {{ sites| safe }}
			var data = {{ existing_saer_data| safe }}
			var barChart = new Chart(barChartCanvas, {
				type: 'bar',
				data: {
					labels:labels ,
					datasets: [{
						label: '# Existing SAE Records',
						data: data,
						backgroundColor: [
						'rgba(255, 99, 132, 0.2)',
						'rgba(54, 162, 235, 0.2)',
						'rgba(255, 206, 86, 0.2)',
						'rgba(75, 192, 192, 0.2)',
						'rgba(153, 102, 255, 0.2)',
						'rgba(255, 159, 64, 0.2)'
						],
						borderColor: [
						'rgba(255,99,132,1)',
						'rgba(54, 162, 235, 1)',
						'rgba(255, 206, 86, 1)',
						'rgba(75, 192, 192, 1)',
						'rgba(153, 102, 255, 1)',
						'rgba(255, 159, 64, 1)'
						],
						borderWidth: 1,
						fill: false
					}]
					},
			});
   });

</script>

<script>
	$(document).on('click', '.panel-heading span.clickable', function(e){
		var $this = $(this);
		if(!$this.hasClass('panel-collapsed')) {
			$this.parents('.panel').find('.panel-body').slideUp();
			$this.addClass('panel-collapsed');
			$this.find('i').removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
			
		} else {
			$this.parents('.panel').find('.panel-body').slideDown();
			$this.removeClass('panel-collapsed');
			$this.find('i').removeClass('glyphicon-chevron-up').addClass('glyphicon-chevron-down');
			
		}
	})
	</script>

{% endblock extra-scripts %}




{% block main %}

	<div class="container">
		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading"><b>Serious Adverse Events Stats</b></div>
				<table class="table table-hover">
					  <thead>
					    <tr>
					      <th></th>
					      <th colspan="5" class="text-center">Sites</th>
					      <th>Overall</th>
					    </tr>
					  </thead>
					  <tbody>
					  	<tr>
					        <td ></td>
					        {% for tsae in total_sae %}
					      	    <td>{{ tsae.0 }}</td>
					        {% endfor %}
					    </tr>
					     <tr>
					      <td>SAE Experienced</td>
					      {% for tsae in total_sae %}
					      	<td>{{ tsae.1 }}</td>
					      {% endfor %}
					    </tr>

					  </tbody>
					</table>
				   </div>

			</div>
		</div>


		<br>
		<br>

        <div class="row">
            <div class="col-md-6">
                <canvas id="barChart1"></canvas>
            </div>
		</div>
		<br>
		<br>
		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading"><b>Existing Serious Adverse Events Records Stats</b></div>
				<table class="table table-hover">
					  <thead>
					    <tr>
					      <th></th>
					      <th colspan="5" class="text-center">Sites</th>
					      <th>Overall</th>
					    </tr>
					  </thead>
					  <tbody>
					  	<tr>
					        <td ></td>
					        {% for esae in existing_sae_records %}
					      	    <td>{{ esae.0 }}</td>
					        {% endfor %}
					    </tr>
                       <tr>
					      <td>Existing SAE Records</td>
					      {% for esae in existing_sae_records %}
					      	<td>{{ esae.1 }}</td>
					      {% endfor %}
					    </tr>

					  </tbody>
					</table>
				   </div>

			</div>
		</div>

        <div class="row">
            <div class="col-md-6">
                <canvas id="barChart2"></canvas>
            </div>
		</div>

		<div class="row">
			<div class="panel panel-info">
			   <div class="panel-heading"><b>Experienced Serious Adverse Event</b></div>
				   <div class="panel-body">
					   <div class="row">
						   <table id="example" class="table table-striped table-bordered" style="width:100%;">
							   <thead>
								  <tr>
									   <th>PID</th>
									   <th>Site</th>
									   <th>AE number</th>
									   <th>Gender</th>
									   <th>DOB</th>
									   <th>Vax date 1</th>
									   <th>Vax date 2</th>
									   <th>AE reported term</th>
									   <th>Intensity of SAE</th>
									   <th>Date AE Met Criteria for Serious AE </th>
									   <th>SAE Stop Date</th>
									   <th>Results in death</th>
									   <th>Was it a congenital anomaly or birth defect</th>
									   <th>Was it life threatening</th>
									   <th>Did it result in significant disability/incapacity? </th>
									   <th>Other medically important serious event?</th>
									   <th>Primary cause of death</th>
									   <th>Secondary cause of death</th>
									   <th>SAE caused by study procedure</th>
								   </tr>
							   </thead>
							   <tbody>
							   {% for ae in saesr %}
								   <tr>
									   <td>{{ ae.serious_adverse_event.subject_identifier }}</td>
									   <td>
										   {% if ae.site_id == 40 %}
										   {{ 'Gaborone' }}
										   {% elif ae.site_id == 41 %}
										   {{ 'Maun' }}
										   {% elif ae.site_id == 42 %}
										   {{ 'Serowe' }}
										   {% elif ae.site_id == 43 %}
										   {{ 'F/town' }}
										   {% elif ae.site_id == 44 %}
										   {{ 'Phikwe' }}
										   {% endif %}
									   </td>
									   <td>{{ae.ae_number}}</td>
									   <td>{{ae.gender}}</td>
									   <td>{{ae.dob}}</td>
									   <td>{% if ae.first_dose_date %}{{ ae.first_dose_date }}{% else %}Not given first dose {% endif %}</td>
									   <td>{% if ae.second_dose_date %}{{ ae.second_dose_date }}{% else %}Not given second dose {% endif %}</td>
									   <td>{{ ae.sae_name }}</td>
									   <td>{{ae.sae_intensity}}</td>
									   <td>{{ae.start_date}}</td>
									   <td>{{ae.resolution_date}}</td>
									   <td>{{ae.ae_sdth}}</td>
									   <td>{{ ae.ae_scong }}</td>
									   <td>{{ ae.ae_slife }}</td>
									   <td>{{ ae.ae_sdisab }}</td>
									   <td>{{ ae.ae_smie }}</td>
									   <td>{{ ae.dthcaus_1 }}</td>
									   <td>{{ ae.dthcaus_2 }}</td>
									   <td>{{ ae.ae_caussp }}</td>
   
								   </tr>
							   {% endfor %}
							   </tbody>
   
						   </table>
					   </div>	
				   </div>
			</div>
		</div>

		<div class="row">
			<div class="panel panel-primary">
				<div class="panel-heading"><b>Serious Adverse Events Without Records Stats</b></div>
				<table class="table table-hover">
					  <thead>
					    <tr>
					      <th></th>
					      <th colspan="5" class="text-center">Sites</th>
					      <th>Overall</th>
					    </tr>
					  </thead>
					  <tbody>
					  	<tr>
					        <td ></td>
					        {% for msae in missing_sae_records %}
					      	    <td>{{ msae.0 }}</td>
					        {% endfor %}
					    </tr>
                      <tr>
					        <td ></td>
					        {% for msae in missing_sae_records %}
					      	    <td>{{ msae.1 }}</td>
					        {% endfor %}
					    </tr>

					  </tbody>
					</table>
				   </div>

			</div>
		</div>
<br>
<br>
<br>
	
	   </div>

   </div>

{% endblock main %}